<jqassistant-rules xmlns="http://schema.jqassistant.org/rule/v1.10"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://schema.jqassistant.org/rule/v1.10 http://schema.jqassistant.org/rule/jqassistant-rule-v1.10.xsd">

    <concept id="jakartaee-ejb:StatelessSessionBean">
        <providesConcept refId="ejb:EJB" />
        <providesConcept refId="ejb:StatelessSessionBean" />
        <description>Labels all types annotated with @jakarta.ejb.Stateless with "EJB" and "Stateless".</description>
        <cypher><![CDATA[
            MATCH (t:Type)-[:ANNOTATED_BY]->()-[:OF_TYPE]->(a:Type)
            WHERE a.fqn="jakarta.ejb.Stateless"
            SET t:JEE:EJB:Stateless
            RETURN t AS EJB
        ]]></cypher>
    </concept>

    <concept id="jakartaee-ejb:StatefulSessionBean">
        <providesConcept refId="ejb:EJB" />
        <providesConcept refId="ejb:StatefulSessionBean" />
        <description>Labels all types annotated with @jakarta.ejb.Stateful with "EJB" and "Stateful".</description>
        <cypher><![CDATA[
            MATCH (t:Type)-[:ANNOTATED_BY]->()-[:OF_TYPE]->(a:Type)
            WHERE a.fqn="jakarta.ejb.Stateful"
            SET t:JEE:EJB:Stateful
            RETURN t AS EJB
        ]]></cypher>
    </concept>

    <concept id="jakartaee-ejb:SingletonBean">
        <providesConcept refId="ejb:EJB" />
        <providesConcept refId="ejb:SingletonBean" />
        <description>Labels all classes annotated with @jakarta.ejb.Singleton with "EJB" and "Singleton".</description>
        <cypher><![CDATA[
            MATCH (t:Type)-[:ANNOTATED_BY]->()-[:OF_TYPE]->(a:Type)
            WHERE a.fqn="jakarta.ejb.Singleton"
            SET t:JEE:EJB:Singleton
            RETURN t AS EJB
        ]]></cypher>
    </concept>

    <concept id="jakartaee-ejb:MessageDrivenBean">
        <providesConcept refId="ejb:EJB" />
        <providesConcept refId="ejb:MessageDrivenBean" />
        <description>Labels all types annotated with @jakarta.ejb.MessageDriven with "EJB" and "MessageDriven".
        </description>
        <cypher><![CDATA[
            MATCH (t:Type)-[:ANNOTATED_BY]->()-[:OF_TYPE]->(a:Type)
            WHERE a.fqn="jakarta.ejb.MessageDriven"
            SET t:JEE:EJB:MessageDriven
            RETURN t AS EJB
        ]]></cypher>
    </concept>

    <concept id="jakartaee-ejb:Local">
        <providesConcept refId="ejb:Local"/>
        <description>Labels all types annotated with @jakarta.ejb.Local with "Local".</description>
        <cypher><![CDATA[
            MATCH (t:Type)-[:ANNOTATED_BY]->()-[:OF_TYPE]->(a:Type)
            WHERE a.fqn="jakarta.ejb.Local"
            SET t:JEE:Local
            RETURN t AS LocalBean
        ]]></cypher>
    </concept>

    <concept id="jakartaee-ejb:Remote">
        <providesConcept refId="ejb:Remote"/>
        <description>Labels all types annotated with @jakarta.ejb.Remote with "Remote".</description>
        <cypher><![CDATA[
            MATCH (t:Type)-[:ANNOTATED_BY]->()-[:OF_TYPE]->(a:Type)
            WHERE a.fqn="jakarta.ejb.Remote"
            SET t:JEE:Remote
            RETURN t AS RemoteBean
        ]]></cypher>
    </concept>

    <concept id="jakartaee-ejb:Schedule">
        <providesConcept refId="ejb:Schedule"/>
        <description>Labels all methods annotated with @jakarta.ejb.Schedule with "Schedule".</description>
        <cypher><![CDATA[
            MATCH (m:Method)-[:ANNOTATED_BY]->()-[:OF_TYPE]->(a:Type)
            WHERE a.fqn="jakarta.ejb.Schedule"
            SET m:JEE:Schedule
            RETURN m AS ScheduledMethod
        ]]></cypher>
    </concept>

    <concept id="jakartaee-ejb:TypeLevelTransactionAttribute">
        <providesConcept refId="ejb:TransactionAttribute"/>
        <requiresConcept refId="ejb:EJB"/>
        <description>
            Identifies the configured type level transaction attribute based on the "jakarta.ejb.TransactionAttribute" annotation.
        </description>
        <cypher><![CDATA[
            MATCH
              (ejb:Java:Type:JEE:EJB)-[:ANNOTATED_BY]->(annotation:Java:Annotation),
              (annotation)-[:OF_TYPE]-(annotationType:Type {fqn: 'jakarta.ejb.TransactionAttribute'})
            OPTIONAL MATCH
              (annotation)-[:HAS]->(propagation:Value {name: 'value'})-[:IS]->(propagationType:Java:Field)
            WITH
              ejb,
              COALESCE(SPLIT(propagationType.signature,' ')[1], 'REQUIRED') AS propagationType
            SET
              ejb.transactionAttribute = propagationType
            RETURN
              ejb as Ejb,
              ejb.transactionAttribute as TransactionAttribute
        ]]></cypher>
    </concept>

    <concept id="jakartaee-ejb:MethodLevelTransactionAttribute">
        <providesConcept refId="ejb:TransactionAttribute"/>
        <requiresConcept refId="ejb:EJB"/>
        <description>
            Identifies the configured method level transaction attribute based on the "jakarta.ejb.TransactionAttribute" annotation.
        </description>
        <cypher><![CDATA[
            MATCH
              (ejb:Java:Type:JEE:EJB)-[:DECLARES]->(method:Java:Method),
              (method)-[:ANNOTATED_BY]->(annotation:Java:Annotation),
              (annotation)-[:OF_TYPE]-(annotationType:Type {fqn: 'jakarta.ejb.TransactionAttribute'})
            OPTIONAL MATCH
              (annotation)-[:HAS]->(propagation:Value {name: 'value'})-[:IS]->(propagationType:Java:Field)
            WITH
              ejb,
              method,
              COALESCE(SPLIT(propagationType.signature,' ')[1], 'REQUIRED') AS propagationType
            SET
              method.transactionAttribute = propagationType
            RETURN
              ejb as Ejb,
              method as Method,
              method.transactionAttribute as TransactionAttribute
        ]]></cypher>
    </concept>

</jqassistant-rules>